"use strict";var updateStatusIsUnlocking=function(chestId){var platformTarget=$("#"+chestId),startButtonTarget=platformTarget.find(".startButton"),upgradeButtonTarget=platformTarget.find(".upgradeButton");$.confirm(confirmWindow("確定啟動寶箱嗎！？","",function(){ajaxDeferred("PUT","/chest/updateStatus/"+chestId,{status:"UNLOCKING"}).then(function(){return $(".container .space .startButton[data-status=LOCKED]").fadeOut("slow"),upgradeButtonTarget.fadeOut("slow"),startButtonTarget.attr("data-status","UNLOCKING"),ajaxDeferred("GET","/chest/coolDownTime/"+chestId)}).then(function(jsonData){countDown(jsonData.content,chestId,platformTarget)})}))},countDown=function(seconds,chestId,platformTarget){var imgChestTarget=platformTarget.find(".chest"),countdownTarget=platformTarget.find(".countdown"),openNowBtnTarget=platformTarget.find(".openNowButton");imgChestTarget.addClass("unlockingGray"),openNowBtnTarget.removeAttr("style");var countDownFunc=function(seconds){countdownTarget.countDown({timeInSecond:seconds,displayTpl:"<i style='font-size:28px;color:yellow' class='fa'>&#xf254;</i>{hour}時{minute}分{second}秒",limit:"hour",callback:function(){openNowBtnTarget.fadeOut(),eventChest.updateStatusIsReady(chestId),imgChestTarget.removeClass("unlockingGray")}})};platformTarget.find(".openNowButton").on("click",function(event){if(event.preventDefault(),!$(this).attr("data-lockedAt")||+new Date-+$(this).attr("data-lockedAt")>1e3){var _seconds=void 0,_chestId=$(this).parents(".platform").prop("id");ajaxDeferred("GET","/chest/coolDownTime/"+_chestId).then(function(jsonData){return _seconds=jsonData.content,ajaxDeferred("GET","/chest/condition/one/openImmediately")}).then(function(jsonData){var consume=jsonData.content.content,deductGems=Math.ceil(_seconds/3600)*consume.everyHourDeductGems;$.confirm(confirmWindow("立即開啟寶箱需要花費 "+deductGems+" 個寶石","確定立即開啟寶箱嗎？",function(){ajax("PUT","/chest/open/immediately/"+_chestId,{deductGems:deductGems},function(jsonData){var originalGems=$(".space .gems #own-gems").text(),insufficientGems=jsonData.content.insufficientGems,finalGems=void 0;insufficientGems>0?$.alert(alertWindow("你的寶石不足"+insufficientGems+" 個","","")):(finalGems=jsonData.content.finalGems,countTrasition("own-gems",originalGems,finalGems),countDownFunc(0))})}))})}$(this).attr("data-lockedAt",+new Date)}),countDownFunc(seconds)};